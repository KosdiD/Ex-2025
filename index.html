<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Smart Home XR Tour</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles.css">
    
    <!-- A-Frame —Ç–∞ –ø–ª–∞–≥—ñ–Ω–∏ -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.5.4/dist/aframe-extras.min.js"></script>
    
    <!-- TensorFlow.js –¥–ª—è ML -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/speech-commands@0.5.4/dist/speech-commands.min.js"></script>
    
    <script src="script.js" defer></script>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é -->
    <button id="menu-toggle" onclick="toggleAllPanels()" title="–í—ñ–¥–∫—Ä–∏—Ç–∏/–ó–∞–∫—Ä–∏—Ç–∏ –º–µ–Ω—é">‚ò∞</button>

    <!-- –ö–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—É —Ç–∞ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è -->
    <div id="time-control" class="panel">
        <h4>‚è∞ –ß–∞—Å –¥–æ–±–∏ —Ç–∞ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è</h4>
        <div id="time-display">12:00</div>
        <input type="range" id="time-slider" min="0" max="1439" value="720" oninput="updateTimeOfDay(this.value)">
        <div class="time-preset">
            <button onclick="setTimePreset(360)">üåÖ –†–∞–Ω–æ–∫ (6:00)</button>
            <button onclick="setTimePreset(540)">‚òÄÔ∏è –î–µ–Ω—å (9:00)</button>
            <button onclick="setTimePreset(720)">üåû –ü–æ–ª—É–¥–µ–Ω—å (12:00)</button>
            <button onclick="setTimePreset(1080)">üåá –í–µ—á—ñ—Ä (18:00)</button>
            <button onclick="setTimePreset(1320)">üåô –ù—ñ—á (22:00)</button>
        </div>
        <div class="light-info">
            <div class="light-status">
                <div class="light-indicator" id="light-indicator"></div>
                <span>–Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å: <span id="light-intensity">100%</span></span>
            </div>
            <div>–ö–æ–ª—ñ—Ä: <span id="light-color">#ffffff</span></div>
            <div>–†–µ–∂–∏–º: <span id="light-mode">–î–µ–Ω–Ω–∏–π</span></div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è -->
    <div id="controls-panel">
        <div class="control-group">
            <strong>üéÆ –í–∏—Å–æ—Ç–∞ –≥—Ä–∞–≤—Ü—è:</strong><br>
            <button onclick="changeHeight(-1)">‚Üì</button>
            <input type="number" id="height-input" value="10" min="0" max="50">
            <button onclick="changeHeight(1)">‚Üë</button>
            <button onclick="setHeight()">–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏</button><br>
            <small>–ü–æ—Ç–æ—á–Ω–∞ –≤–∏—Å–æ—Ç–∞: <span id="current-height">10</span>–º</small>
        </div>

        <div class="control-group">
            <strong>üìç –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä—ñ–≤:</strong><br>
            <button onclick="createMarkerAtCurrentPosition()">–°—Ç–≤–æ—Ä–∏—Ç–∏ –º–∞—Ä–∫–µ—Ä —Ç—É—Ç</button>
            <div id="marker-form" style="display: none;">
                <select id="ml-device-type" style="width: 100%; margin: 5px 0; padding: 5px;">
                    <option value="">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π IoT</option>
                    <option value="vision">üëÅÔ∏è Computer Vision</option>
                    <option value="audio">üîä –ê—É–¥—ñ–æ ML</option>
                    <option value="sensor">üìä –°–µ–Ω—Å–æ—Ä–Ω–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞</option>
                    <option value="motion">üèÉ –î–µ—Ç–µ–∫—Ç–æ—Ä —Ä—É—Ö—É</option>
                    <option value="climate">üå°Ô∏è –ö–ª—ñ–º–∞—Ç ML</option>
                </select>
                <input type="text" id="marker-name" placeholder="–ù–∞–∑–≤–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é">
                <textarea id="marker-description" placeholder="–û–ø–∏—Å –ø—Ä–∏—Å—Ç—Ä–æ—é" rows="3"></textarea>
                <button onclick="saveMarker()">‚úÖ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
                <button onclick="cancelMarker()">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>

        <div class="control-group">
            <strong>üè† –®–≤–∏–¥–∫—ñ –¥—ñ—ó:</strong><br>
            <button onclick="resetPosition()">‚Ü©Ô∏è –ù–∞ –ø–æ—á–∞—Ç–æ–∫</button>
            <button onclick="toggleMarkers()">üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç–∏/–°—Ö–æ–≤–∞—Ç–∏</button>
        </div>

        <div class="control-group">
            <strong>üíæ –ï–∫—Å–ø–æ—Ä—Ç/–Ü–º–ø–æ—Ä—Ç:</strong><br>
            <button onclick="exportMarkers()">üì• –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –º–∞—Ä–∫–µ—Ä–∏</button>
            <button onclick="document.getElementById('import-file').click()">üì§ –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –º–∞—Ä–∫–µ—Ä–∏</button>
            <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importMarkers(event)">
        </div>
    </div>

    <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–æ–∑–∏—Ü—ñ—é -->
    <div id="position-info">
        <strong>–ü–æ–∑–∏—Ü—ñ—è:</strong><br>
        X: <span id="pos-x">0</span><br>
        Y: <span id="pos-y">10</span><br>
        Z: <span id="pos-z">20</span>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó IoT -->
    <div id="iot-info-panel">
        <h3 id="iot-title">IoT –ü—Ä–∏—Å—Ç—Ä—ñ–π</h3>
        <p><span class="info-label">–¢–∏–ø:</span> <span id="iot-type">-</span></p>
        <p><span class="info-label">–û–ø–∏—Å:</span> <span id="iot-description">-</span></p>
        <p><span class="info-label">ML –ú–æ–¥–µ–ª—ñ:</span> <span id="iot-ml-models">-</span></p>
        <p><span class="info-label">ML –§—É–Ω–∫—Ü—ñ—ó:</span> <span id="iot-ml-features">-</span></p>
        <p><span class="info-label">–°—Ç–∞—Ç—É—Å:</span> <span id="iot-status">–ê–∫—Ç–∏–≤–Ω–∏–π</span></p>
        <p><span class="info-label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</span> <span id="iot-coords">-</span></p>
        <button onclick="closeIotPanel()">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∫–µ—Ä—É–≤–∞–Ω–Ω—è -->
    <div id="voice-control" class="panel">
        <h3>üé§ –ì–æ–ª–æ—Å–æ–≤–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
        <button id="voice-btn" onclick="toggleVoiceRecognition()">
            <span id="voice-btn-text">–ü–æ—á–∞—Ç–∏ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è</span>
        </button>
        <button onclick="toggleMLMode()">
            <span id="ml-mode-text">ML: –í–∏–º–∫</span>
        </button>
        <div id="voice-status">
            <span class="voice-indicator" id="voice-indicator"></span>
            <span id="voice-status-text">–ì–æ—Ç–æ–≤–æ –¥–æ —Ä–æ–±–æ—Ç–∏</span>
            <div id="voice-transcript"></div>
        </div>
        <small>–ö–æ–º–∞–Ω–¥–∏: "—Å—Ç–≤–æ—Ä–∏—Ç–∏ –º–∞—Ä–∫–µ—Ä", "–ø–æ–∫–∞–∑–∞—Ç–∏ –º–∞—Ä–∫–µ—Ä–∏", "—Å—Ö–æ–≤–∞—Ç–∏ –º–∞—Ä–∫–µ—Ä–∏", "–Ω–∞ –ø–æ—á–∞—Ç–æ–∫", "–µ–∫—Å–ø–æ—Ä—Ç", "–∫–∞–º–µ—Ä–∞ –≤–≥–æ—Ä—É/–≤–Ω–∏–∑"</small>
    </div>

    <!-- XR —Å—Ü–µ–Ω–∞ -->
    <a-scene background="color: #87CEEB" fog="type: linear; color: #87CEEB; near: 10; far: 100" id="main-scene">
        <!-- –ê—Å–µ—Ç–∏ -->
        <a-assets>
            <a-asset-item id="house-model" src="box.glb"></a-asset-item>
            <!-- –î–æ–¥–∞–π—Ç–µ —à—Ä–∏—Ñ—Ç–∏ —Ç—É—Ç -->
            <a-asset-item id="arialFont" src="fonts/arial-msdf.json"></a-asset-item>
            <img id="arialFontTexture" src="fonts/arial-msdf.png">
        </a-assets>

        <!-- –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è -->
        <a-light type="ambient" intensity="0.3" color="#ffffff" id="ambient-light"></a-light>
        <a-light type="directional" position="20 40 20" intensity="0.8" castShadow="true" 
                 id="sun-light" color="#ffffff"></a-light>
        
        <!-- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–∂–µ—Ä–µ–ª–∞ —Å–≤—ñ—Ç–ª–∞ –¥–ª—è –∫—ñ–º–Ω–∞—Ç -->
        <a-entity id="room-lights">
            <!-- –°–≤—ñ—Ç–ª–æ –∫—ñ–º–Ω–∞—Ç–∏ 1 -->
            <a-light type="point" position="5 8 5" intensity="0" color="#ffd700" 
                     distance="20" decay="2" id="room-light-1"></a-light>
            <!-- –°–≤—ñ—Ç–ª–æ –∫—ñ–º–Ω–∞—Ç–∏ 2 -->
            <a-light type="point" position="-5 8 5" intensity="0" color="#ffd700" 
                     distance="20" decay="2" id="room-light-2"></a-light>
            <!-- –°–≤—ñ—Ç–ª–æ –∫—ñ–º–Ω–∞—Ç–∏ 3 -->
            <a-light type="point" position="5 8 -5" intensity="0" color="#ffd700" 
                     distance="20" decay="2" id="room-light-3"></a-light>
            <!-- –°–≤—ñ—Ç–ª–æ –∫—ñ–º–Ω–∞—Ç–∏ 4 -->
            <a-light type="point" position="-5 8 -5" intensity="0" color="#ffd700" 
                     distance="20" decay="2" id="room-light-4"></a-light>
        </a-entity>

        <!-- –ù–µ–±–æ –∑ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–º –∫–æ–ª—å–æ—Ä–æ–º -->
        <a-sky id="sky" color="#87CEEB"></a-sky>

        <!-- –ì—Ä—É–Ω—Ç -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="200" height="200"
                 color="#4a5d4a" shadow="receive: true" id="ground"></a-plane>

        <!-- –ë—É–¥–∏–Ω–æ–∫ -->
        <a-gltf-model src="#house-model" position="0 0 0" scale="1 1 1" rotation="0 0 0"
                      shadow="cast: true; receive: true" id="house">
        </a-gltf-model>

        <!-- –í—ñ–∫–Ω–∞ —Ç–∞ —Ä–æ–ª–µ—Ç–∏ -->
        <a-entity id="windows-blinds">
            <!-- –í—ñ–∫–Ω–æ 1 –∑ —Ä–æ–ª–µ—Ç–æ—é -->
            <a-entity position="10 5 0">
                <a-box width="3" height="4" depth="0.1" color="#87ceeb" opacity="0.3"></a-box>
                <a-box id="blind-1" class="blind" width="3" height="4" depth="0.2" 
                       position="0 2 0.2" color="#8b4513" opacity="0.9"
                       animation__close="property: position; to: 0 0 0.2; dur: 2000; startEvents: close-blind"
                       animation__open="property: position; to: 0 2 0.2; dur: 2000; startEvents: open-blind">
                </a-box>
            </a-entity>
            
            <!-- –í—ñ–∫–Ω–æ 2 –∑ —Ä–æ–ª–µ—Ç–æ—é -->
            <a-entity position="-10 5 0">
                <a-box width="3" height="4" depth="0.1" color="#87ceeb" opacity="0.3"></a-box>
                <a-box id="blind-2" class="blind" width="3" height="4" depth="0.2" 
                       position="0 2 0.2" color="#8b4513" opacity="0.9"
                       animation__close="property: position; to: 0 0 0.2; dur: 2000; startEvents: close-blind"
                       animation__open="property: position; to: 0 2 0.2; dur: 2000; startEvents: open-blind">
                </a-box>
            </a-entity>
        </a-entity>

        <!-- –ö–∞–º–µ—Ä–∞ -->
        <a-entity id="rig" position="0 10 20" movement-controls="fly: false;">
            <a-entity id="camera"
                      camera
                      look-controls="pointerLockEnabled: true"
                      wasd-controls="acceleration: 25; fly: false"
                      position="0 1.6 0">
                <a-cursor fuse="false"
                          raycaster="objects: .iot-marker"
                          material="color: #00ff88; shader: flat">
                </a-cursor>
            </a-entity>
        </a-entity>

        <!-- –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –º–∞—Ä–∫–µ—Ä –Ω–∞ 0,0,0 -->
        <a-entity id="marker-0-0-0" position="0 0 0">
            <a-sphere class="iot-marker"
                      radius="0.5"
                      color="#00bcd4"
                      opacity="0.7"
                      event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2; opacity: 0.9"
                      event-set__leave="_event: mouseleave; scale: 1 1 1; opacity: 0.7"
                      animation="property: rotation; to: 0 360 0; loop: true; dur: 10000">
            </a-sphere>
            <a-text value="–†–æ–∑—É–º–Ω–∏–π —Ö–∞–±"
                    position="0 1 0"
                    width="4"
                    align="center"
                    color="#fff"
                    font="arialFont">
            </a-text>
        </a-entity>
    </a-scene>
</body>
</html>
